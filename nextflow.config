plugins {
    id 'nf-schema@2.1.0'
}

validation {
   help {
        enabled = true
        command = "nextflow run BacterialGenomeComparison/main.nf --metadata organism.csv --genus Escherichia"
    }
}

params {
    anaconda_base    = "/opt/anaconda3"
    eggnog_data_dir  = "$HOME/eggnog_data"
    genus            = ""
    metadata         = ""
    nextflow_reports = "pipeline_reports"
    outdir           = "results"
    skip_eggnog      = false
}

includeConfig 'conf/tower.config'

def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss' )
def save_dir = "${params.nextflow_reports}"

report { 
    enabled   = true
    file      = "${save_dir}/execution_report_${trace_timestamp}.html"
    overwrite = true
}

timeline {
    enabled   = true
    file      = "${save_dir}/execution_timeline_${trace_timestamp}.html"
    overwrite = true
}

dag {
    enabled   = true
    file      = "${save_dir}/execution_dag_${trace_timestamp}.html"
    overwrite = true
    verbose   = true
}

profiles {
    standard {
        includeConfig 'conf/modules.config'
        conda.enabled = false
        docker {
            enabled    = true
            runOptions = '-u $(id -u):$(id -g)'
            registry   = "quay.io"
        }
        process {
            cache         = "lenient"
            errorStrategy = "finish"
        }
    }
    conda {
        includeConfig 'conf/modules.config'
        conda {
            enabled  = true
            cacheDir = "$params.anaconda_base/envs/"
            channels = ['conda-forge', 'bioconda', 'defaults']
        }
        docker.enabled = false
        process {
            cache         = "lenient"
            errorStrategy = "finish"
        }
    }
    stub {
        process {
            cpus   = 1
            memory = "1 GB"
        }
        conda.enabled  = false
        docker.enabled = false
        tower.enabled  = false
    }
}

manifest {
   name        = 'BacterialGenomeComparison'
   description = 'This pipeline is designed to compare genomes of bacteria of the same species from different sources using pre-selected tools'
   author      = 'Maria Bruna Pilotto'
   version     = '2025.08.19'
}
